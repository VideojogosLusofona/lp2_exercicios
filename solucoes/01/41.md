## Problema

41 - Cria uma classe chamada `HighScoreManager`, que contém internamente uma
coleção com um máximo de 10 `Tuple<string, float>`, cada um representando o
nome de um jogador e o respetivo _score_. Além da coleção referida, a classe
deve ainda conter:

* Um construtor, que aceita opcionalmente um nome de ficheiro (deve existir
  um nome por omissão), e:
  * Caso o ficheiro não exista, inicializa a coleção sem elementos.
  * Caso o ficheiro exista, abre-o e inicializa a coleção de modo a que
    contenha os nomes e _scores_ especificados no ficheiro.
  * Caso o ficheiro exista, mas tenha um formato inválido, lançar uma excepção
    do tipo `InvalidOperationException`.
* Um método `AddScore(string name, float score)`, que adiciona um novo
  `Tuple<string, float>` à coleção. Se o número de _scores_ ultrapassar 10, o
  tuplo contendo o menor _score_ deve ser removido.
* Um método `Save()`, que guarda os _scores_ no ficheiro especificado no
  construtor.
* Um método `ToString()`, que devolve uma _string_ contendo uma tabela
  devidamente formatada com todos os nomes e _scores_, do mais alto ao mais
  baixo.
* Um método iterável `GetScores()` que retorna de forma ordenada (do _score_
  mais alto até ao _score_ mais baixo) todos tuplos guardados na coleção.

O formato do ficheiro de _high scores_ fica ao critério dos alunos.

Cria também uma classe `Program` com um método `Main` para testar os vários
métodos da classe `HighScoreManager`.

## Soluções

### Solução 1

Classe `HighScoreManager`.

```csharp
using System;
using System.IO;
using System.Text;
using System.Collections.Generic;

namespace Ex_41
{
    public class HighscoreManager
    {
        // Coleção onde escrever os valores lidos
        private List<Tuple<string, float>> _scores;
        private string _file;

        // Comparador usado para os scores
        private CompareTuples _comparer;

        public HighscoreManager(string file = "Scores.txt")
        {
            _file = file;
            _comparer = new CompareTuples();
            _scores = new List<Tuple<string, float>>(10);

            // Verificar se o ficheiro existe
            if (!File.Exists(_file))
            {
                Console.WriteLine("file doesn't exist, " +
                    "initializing Scores without elements");
            }
            else if (Path.GetExtension(_file) != ".txt")
            {
                throw new InvalidOperationException();
            }
            else
            {
                ReadFile();
            }
        }

        // Lê a file especificada no construtor
        private void ReadFile()
        {
            // Bloco try/catch quando se está a aceder o ficheiro
            try
            {
                // Instanciar um `StreamReader` para escrever na file
                using (StreamReader sr = new StreamReader(_file))
                {
                    // String para uso temporário da linha a ser lida
                    string line;

                    while ((line = sr.ReadLine()) != null)
                    {
                        string[] score;
                        // Retirar o nome e o valor em string da linha lida
                        score = line.Split(' ');

                        // Adicionar Score
                        AddScore(score[0], Convert.ToSingle(score[1]));
                    }
                }
            }
            catch (Exception e)
            {
                Console.WriteLine("Couldn't read from file, something went wrong");
                Console.WriteLine(e.Message);
            }
        }

        // Grava o leaderboard na file especificada no construtor
        public void Save()
        {
            // Bloco try/catch quando se está a aceder o ficheiro
            try
            {
                // Instanciar um `StreamWriter` para escrever na file
                using (StreamWriter sw = new StreamWriter(_file))
                {
                    // Escrever todos os scores da instância
                    for (int i = 0; i < _scores.Count; i++)
                    {
                        sw.WriteLine(ScoreLine(_scores[i]));
                    }
                }
            }
            catch (Exception e)
            {
                Console.WriteLine("Couldn't save file, something went wrong");
                Console.WriteLine(e.Message);
            }
        }

        // Adiciona um Score através do nome e do valor
        public void AddScore(string name, float score)
        {
            Tuple<string, float> newScore;
            newScore = new Tuple<string, float>(name, score);

            _scores.Sort(_comparer);
            if (_scores.Count < 10)
            {
                _scores.Add(newScore);
            }
            else if (_scores[9].Item2 < score)
            {
                _scores.RemoveAt(9);
                _scores.Add(newScore);
            }
        }

        public IEnumerable<Tuple<string, float>> GetScores()
        {
            // Organizar o array
            _scores.Sort(_comparer);

            // Retornar cada elemento do array
            foreach (Tuple<string, float> t in _scores)
            {
                yield return t;
            }
        }


        // Função intermédia para a string de um score
        private string ScoreLine(Tuple<string, float> score)
        {
            return score.Item1 + ' ' + score.Item2.ToString();
        }

        public override string ToString()
        {
            // String builder para construir a tabela
            StringBuilder sb;

            // Organizar o array
            _scores.Sort(_comparer);

            sb = new StringBuilder("\tLEADERBOARDS \n \n");
            sb.Append("   Name: \t   Score: \n");

            for (int i = 0; i < _scores.Count; i++)
            {
                sb.AppendLine($"{_scores[i].Item1,8} "
                    + "".PadRight(9, '-')
                    + $" {_scores[i].Item2}");
            }

            return sb.ToString();
        }
    }
}
```

Classe `CompareTuples`

```csharp
using System;
using System.Collections.Generic;

namespace Ex_41
{
    public class CompareTuples : IComparer<Tuple<string, float>>
    {
        public int Compare(Tuple<string, float> score1, Tuple<string, float> score2)
        {
            if (score1 == null) return 1;
            if (score2 == null) return -1;

            return Comparer<float>.Default.Compare(score2.Item2, score1.Item2);
        }
    }
}
```

Classe `Program` para testes.

```csharp
using System;

namespace Ex_41
{
    class Program
    {
        static void Main(string[] args)
        {
            HighscoreManager hsMng, hsMng2;
            hsMng = new HighscoreManager("Leaderboard.txt");
            hsMng2 = new HighscoreManager();

            hsMng.AddScore("Joao", 2);
            hsMng.AddScore("Catarina", 10230.04f);
            hsMng.AddScore("Raquel", 2.5f);
            hsMng.AddScore("Batman", 10230.05f);
            hsMng.AddScore("Anakin", 233);
            hsMng.AddScore("Vader", 124.06f);
            hsMng.AddScore("Vader", 394.06f);
            hsMng.AddScore("SkyW4lkr", 200.4f);
            hsMng.AddScore("Joker", 509.06f);
            hsMng.AddScore("Kojer", 4000.06f);
            hsMng.AddScore("Superman", 745.06f);
            hsMng.AddScore("Potter", 100.5f);

            hsMng2.AddScore("Rita", 22.65f);
            hsMng2.AddScore("Henrique", 22.653f);
            hsMng2.AddScore("Batman", 100.6f);
            hsMng2.AddScore("Harry", 150);

            hsMng2.Save();
            hsMng.Save();
            Console.WriteLine(hsMng);
            Console.WriteLine(hsMng2);

            foreach (Tuple<string, float> t in hsMng.GetScores())
            {
                Console.WriteLine(t);
            }

            Console.WriteLine();
            foreach (Tuple<string, float> t in hsMng2.GetScores())
            {
                Console.WriteLine(t);
            }
        }
    }
}
```

### Solução 2

Classe HighScoreManager:

```csharp
using System;
using System.Collections.Generic;
using System.IO;
using System.Runtime.CompilerServices;

namespace _01_41
{
    class HighScoreManager
    {
        /// <summary>
        /// Lista do score (nomes e pontuações).
        /// </summary>
        private List<Tuple<string, float>> ScoreList;
        //

        /// <summary>
        /// Construtor do ficheiro.
        /// </summary>
        /// <param name="name"> Nome do ficheiro. </param>
        public HighScoreManager(string name) {
            ScoreList =
            new List<Tuple<string, float>>();
            FileCheck(name);
        }
        //

        /// <summary>
        /// Verificar a existência do ficheiro.
        /// </summary>
        /// <param name="file"> Nome do ficheiro. </param>
        private void FileCheck(string file) {
            if (File.Exists(file)) {
                Console.WriteLine("Ler ficheiro");
                Read(file);
            } 
            else if (!File.Exists(file)) {
                Console.WriteLine("Ficheiro não existe.");
            } 
            else if (Path.GetExtension(file) != ".txt") {
                throw new InvalidOperationException();
            }
        }
        //

        /// <summary>
        /// Método para ler o ficheiro e separar os dados.
        /// </summary>
        /// <param name="filename"> Nome do ficheiro. </param>
        private void Read(string filename) {
            string s;
            string[] lines;
            StreamReader streamreader = new StreamReader(filename);
            while((s = streamreader.ReadLine()) != null) {
                // Separar os dados por vírgula.
                lines = (s.Split(','));
                //
                // Colocar na lista os dados obtidos.
                AddScore(lines[0], float.Parse(lines[1]));
                //
                
            }
            streamreader.Close();
        }
        //

        /// <summary>
        /// Método para adicionar os dados à lista.
        /// </summary>
        /// <param name="name"> Nome do jogador. </param>
        /// <param name="score"> Pontuação do jogador. </param>
        public void AddScore(string name, float score) {
            ScoreList.Add(new Tuple<string, float>(name, score));
        }
        //

        /// <summary>
        /// Método para guardar os elementos da lista no ficheiro.
        /// </summary>
        /// <param name="filename"> Nome do ficheiro. </param>
        public void Save(string filename) {
            StreamWriter streamwriter = new StreamWriter(filename);
            GetScores();
            foreach(Tuple<string, float> item in ScoreList) {
                streamwriter.WriteLine($"{item.Item1}, {item.Item2},");
            }
            streamwriter.Close();
        }
        //

        /// <summary>
        /// Método para ordenar por ordem decrescente a lista.
        /// </summary>
        private void GetScores() {
            // Ordenar o score
            CompareScore comparescore = new CompareScore();
            ScoreList.Sort(comparescore);
            //

            /* Caso a lista tenha mais de 10 elementos, remover os elementos 
            * com pontuação mais baixa até ficar nos 10 elementos.
            * Como a lista está ordenada por ordem decrescente,
            * removo o elemento que está no fundo (que é o mais baixo).*/
            while (ScoreList.Count > 10) {
                ScoreList.RemoveAt(ScoreList.Count - 1);
            }
            //
        }
        //
    }
}
```

Classe CompareScore:

```csharp
using System;
using System.Collections.Generic;
using System.Text;

namespace _01_41
{
    public class CompareScore : IComparer<Tuple<string, float>>
    {
        /// <summary>
        /// Método para comparar os scores
        /// </summary>
        /// <param name="a"> Tuple para comparar. </param>
        /// <param name="b"> Tuple para comparar. </param>
        /// <returns></returns>
        public int Compare(Tuple<string, float> a, Tuple<string, float> b) {
            if(a.Item2 > b.Item2) {
                return -1;
            }
            if (a.Item2 < b.Item2) {
                return 1;
            }
            else {
                return 0;
            }
        }
        //
    }
}
```

Classe Program:

```csharp
using System;

namespace _01_41
{
    class Program
    {
        static void Main(string[] args) {
            // Quantidade de elementos que o user quer colocar.
            int inputnumber = 0;
            //

            // Input do user.
            string userinput;
            //

            /* Verificar se o user já definiu a quantidade de elementos
             * que quer colocar. */
            bool stopinputnumber = false;
            //

            // Nome do jogador.
            string inputname;
            //

            // Pontuação do jogador.
            int inputscore;
            //

            // Construtor do ficheiro.
            HighScoreManager highscoremanager =
                new HighScoreManager("highscores.txt");
            //

            // Definir a quantidade de elementos que o user quer colocar.
            while (stopinputnumber == false) {
                Console.WriteLine("Quantos scores quer colocar?");
                userinput = Console.ReadLine();
                if (int.TryParse(userinput, out inputnumber)) {
                    Console.WriteLine("Pode começar a colocar os scores.");
                    stopinputnumber = true;
                } else {
                    Console.WriteLine("Input incorrecto, tente de novo.");
                }
            }
            //

            // Definir os nomes dos jogadores e suas respetivas pontuações.
            for (int i = 0; i < inputnumber; i++) {
                Console.WriteLine("Escreva o nome");
                userinput = Console.ReadLine();
                inputname = userinput;
                Console.WriteLine("Escreva o score");
                userinput = Console.ReadLine();
                inputscore = Convert.ToInt32(userinput);
                highscoremanager.AddScore(inputname, inputscore);
            }
            //

            // Método para guardar os elementos da lista no ficheiro.
            highscoremanager.Save("highscores.txt");
            //
        }
    }
}
```

*Por [Francisco Pires](https://github.com/FRP7)*